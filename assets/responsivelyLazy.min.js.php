<?php

/*
 * Responsively lazy addon for Bear Framework
 * https://github.com/ivopetkov/responsively-lazy-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var responsivelyLazy=void 0!==responsivelyLazy?responsivelyLazy:function(){if(void 0!==window.addEventListener&&void 0!==document.querySelectorAll){var e=null,t="srcset"in document.createElement("img"),n=null,r=null,i="undefined"!=typeof IntersectionObserver,o=!1,l=function(e,t){for(var n=e.length,r=t;r<n;r++){var i=!1,o=e[r],a=document.createElement("script"),s=o.getAttribute("type");null!==s&&a.setAttribute("type",s);var u=o.getAttribute("src");if(null!==u&&(a.setAttribute("src",u),(void 0===o.async||!1===o.async)&&r+1<n&&(i=!0,a.addEventListener("load",(function(){l(e,r+1)})))),a.innerHTML=o.innerHTML,o.parentNode.insertBefore(a,o),o.parentNode.removeChild(o),i)break}},a=function(t,n){var r=[],i=n.getAttribute("data-responsively-lazy"),o=null;if(null!==i&&(i=i.trim()).length>0){i=i.split(",");for(var l=0;l<i.length;l++){for(var a=null,s=999998,u=9,d=i[l].trim().split(" "),v=0;v<d.length;v++){var c=d[v],y=c.length;0!==y&&(null===a?a=c:"w"===c[y-1]?s=parseInt(c.substr(0,y-1),10):"webp"===c&&(u=2))}(e||2!==u)&&(r.push([a,s,u]),o<s&&(o=s))}r.sort((function(e,t){return e[1]===t[1]?e[2]-t[2]:e[1]-t[1]}));var f=[];for(l=0;l<r.length;l++){var p=r[l];l>0&&p[1]===f[f.length-1][1]||f.push([p[0],p[1]])}r=f}var w=n.offsetWidth*(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),g=null;for(l=0;l<r.length;l++){if((p=r[l])[1]>=w||p[1]===o){g=p;break}}if(null===g&&(g="img"===t?[n.getAttribute("src"),999999]:[null,999999]),void 0===n.responsivelyLazyOption&&(n.responsivelyLazyOption=["",0]),n.responsivelyLazyOption[1]<g[1]){n.responsivelyLazyOption=g;var A=g[0];if(null===A)return;var m=new Image;m.onload=function(){if("img"===t?A===n.getAttribute("src")?n.removeAttribute("srcset"):n.setAttribute("srcset",A):n.style.backgroundImage="url("+A+")",void 0===n.responsivelyLazyLoadDispached){n.responsivelyLazyLoadDispached=!0;var e=n.getAttribute("data-on-responsively-lazy-load");if(null!==e&&new Function(e).bind(n)(),"undefined"!=typeof Event){var r=new Event("responsively-lazy-load");n.dispatchEvent(r)}}},m.onerror=function(){n.responsivelyLazyOption=["",0]},m.src=A}},s=function(){n=window.innerWidth,r=window.innerHeight},u=function(e){if(void 0===e.responsivelyLazyDone&&function(e){if(null===n)return!1;var t=0,i=0,o=e.getAttribute("data-responsively-lazy-threshold");if(null!==o)if("px"===o.substr(-2))t=i=parseInt(o.substr(0,o.length-2),10);else if("%"===o.substr(-1)){var l=parseInt(o.substr(0,o.length-1),10)/100;t=Math.floor(n*l),i=Math.floor(r*l)}var a=e.getBoundingClientRect(),s=a.top-i,u=a.left-i,d=a.width+2*t,v=a.height+2*t;return s<r&&s+v>0&&u<n&&u+d>0}(e)){var i=e.getAttribute("data-responsively-lazy-type");if("background"!==i&&"html"!==i&&(i="img"),"html"===i){e.responsivelyLazyDone=!0,o=!0,e.innerHTML=e.getAttribute("data-responsively-lazy");var s=e.querySelectorAll("script");s.length>0&&l(s,0),o=!1}else"img"===i?t&&a(i,e):a(i,e)}},d=function(t){if(null!==e)if(void 0!==t)u(n[r]);else for(var n=document.querySelectorAll("[data-responsively-lazy]"),r=0;r<n.length;r++)u(n[r])},v=new Image;v.onload=v.onerror=function(){e=1===v.width,d()},v.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAD8D+JaQAA3AA/ua1AAA=",s();var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},y=!1,f=function(){y&&(y=!1,d()),c.call(null,f)};if(f(),i)var p=new IntersectionObserver((function(e){for(var t in e){var n=e[t];n.intersectionRatio>0&&u(n.target)}})),w=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),t=0;t<e.length;t++){var n=e[t];void 0===n.responsivelyLazyObserver&&(n.responsivelyLazyObserver=!0,p.observe(n))}},g=null;var A=function(){i?(window.clearTimeout(g),g=window.setTimeout((function(){y=!0}),50)):y=!0},m=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),t=0;t<e.length;t++)for(var n=e[t].parentNode;n&&"html"!==n.tagName.toLowerCase();)void 0===n.responsivelyLazyScroll&&(n.responsivelyLazyScroll=!0,n.addEventListener("scroll",A)),n=n.parentNode},b=function(){(window.addEventListener("resize",(function(){s(),A()})),window.addEventListener("scroll",A),window.addEventListener("load",A),window.addEventListener("orientationchange",(function(){s(),A()})),i&&w(),m(),"undefined"!=typeof MutationObserver)&&new MutationObserver((function(){o||(i&&w(),m(),A())})).observe(document.querySelector("body"),{childList:!0,subtree:!0});d()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b()}else d=function(){};return{run:d}}();
EOT;
