<?php

/*
 * Responsively lazy addon for Bear Framework
 * https://github.com/ivopetkov/responsively-lazy-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var responsivelyLazy=void 0!==responsivelyLazy?responsivelyLazy:function(){if(void 0!==window.addEventListener&&void 0!==document.querySelectorAll){var e=null,t="srcset"in document.createElement("img"),n=null,r=null,i="undefined"!=typeof IntersectionObserver,o=!1,l=function(e){var t=0,i=0,o=e.getAttribute("data-responsively-lazy-threshold");if(null!==o)if("px"===o.substr(-2))t=i=parseInt(o.substr(0,o.length-2),10);else if("%"===o.substr(-1)){var l=parseInt(o.substr(0,o.length-1),10)/100;t=Math.floor(n*l),i=Math.floor(r*l)}var a=e.getBoundingClientRect(),s=a.top,u=a.left,d=a.width,v=a.height,c=function(e,t,n){return e<n&&e+t>0?Math.min(n,e+t)-Math.max(0,e):0};return 0===(l=c(u,d,n)*c(s,v,r)/(d*v)*100)&&(i>0||t>0)&&(l=c(u-t,d+2*t,n)*c(s-i,v+2*i,r)/((d+2*t)*(v+2*i))),l},a=function(e,t){for(var n=e.length,r=t;r<n;r++){var i=!1,o=e[r],l=document.createElement("script"),s=o.getAttribute("type");null!==s&&l.setAttribute("type",s);var u=o.getAttribute("src");if(null!==u&&(l.setAttribute("src",u),(void 0===o.async||!1===o.async)&&r+1<n&&(i=!0,l.addEventListener("load",(function(){a(e,r+1)})))),l.innerHTML=o.innerHTML,o.parentNode.insertBefore(l,o),o.parentNode.removeChild(o),i)break}},s=[],u=!1,d=function(){if(!u){u=!0;s=s.filter((function(e){return 2!==e[2]}));for(var e=0;e<s.length;e++)s[e][4]=l(s[e][1]);s.sort((function(e,t){return t[4]-e[4]}));var t=s.filter((function(e){return 1===e[3]})).length;for(e=0;e<s.length&&!(t>=5);e++){var n=s[e];0===n[3]&&(n[3]=1,n[2](),t++)}u=!1}},v=0,c=function(t,n){var r=[],i=n.getAttribute("data-responsively-lazy"),o=null;if(null!==i&&(i=i.trim()).length>0){i=i.split(",");for(var l=0;l<i.length;l++){for(var a=null,u=999998,c=9,f=i[l].trim().split(" "),y=0;y<f.length;y++){var p=f[y],g=p.length;0!==g&&(null===a?a=p:"w"===p[g-1]?u=parseInt(p.substr(0,g-1),10):"webp"===p&&(c=2))}(e||2!==c)&&(r.push([a,u,c]),o<u&&(o=u))}r.sort((function(e,t){return e[1]===t[1]?e[2]-t[2]:e[1]-t[1]}));var h=[];for(l=0;l<r.length;l++){var A=r[l];l>0&&A[1]===h[h.length-1][1]||h.push([A[0],A[1]])}r=h}var w=n.getAttribute("data-responsively-lazy-preferred-option"),b=null!==w?parseInt(w):n.offsetWidth*(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),m=null;for(l=0;l<r.length;l++){if((A=r[l])[1]>=b||A[1]===o){m=A;break}}if(null===m&&(m="img"===t?[n.getAttribute("src"),999999]:[null,999999]),void 0===n.responsivelyLazyOption&&(n.responsivelyLazyOption=["",0]),n.responsivelyLazyOption[1]<m[1]){n.responsivelyLazyOption=m;var L=m[0];if(null===L)return;!function(e,t,n){var r="i"+ ++v,i=null,o=function(){clearTimeout(i);for(var e=0;e<s.length;e++){var t=s[e];if(t[0]===r){t[3]=2;break}}d()},l=new Image;l.onload=function(){o(),n(!0)},l.onerror=function(){o(),n(!1)};s.push([r,e,function(){l.src=t,i=setTimeout(o,6e4)},0,0]),d()}(n,L,(function(e){if(e&&n.responsivelyLazyOption[0]===L){if("img"===t?L===n.getAttribute("src")?n.removeAttribute("srcset"):n.setAttribute("srcset",L):n.style.backgroundImage="url("+L+")",void 0===n.responsivelyLazyLoadDispached){n.responsivelyLazyLoadDispached=!0;var r=n.getAttribute("data-on-responsively-lazy-load");if(null!==r&&new Function(r).bind(n)(),"undefined"!=typeof Event){var i=new Event("responsively-lazy-load");n.dispatchEvent(i)}}}else n.responsivelyLazyOption=["",0]}))}},f=function(){n=window.innerWidth,r=window.innerHeight},y=function(e){if(void 0===e.responsivelyLazyDone&&0!==l(e)){var n=e.getAttribute("data-responsively-lazy-type");if("background"!==n&&"html"!==n&&(n="img"),"html"===n){e.responsivelyLazyDone=!0,o=!0,e.innerHTML=e.getAttribute("data-responsively-lazy");var r=e.querySelectorAll("script");r.length>0&&a(r,0),o=!1}else"img"===n?t&&c(n,e):c(n,e)}},p=function(t){if(null!==e)if(void 0!==t)y(n[r]);else for(var n=document.querySelectorAll("[data-responsively-lazy]"),r=0;r<n.length;r++){t=n[r];y(n[r])}},g=new Image;g.onload=g.onerror=function(){e=1===g.width,p()},g.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAD8D+JaQAA3AA/ua1AAA=",f();var h=window.requestAnimationFrame||function(e){window.setTimeout(e,20)},A=!1,w=function(){A&&(A=!1,p()),h.call(null,w)};if(w(),i)var b=new IntersectionObserver((function(e){for(var t in e){var n=e[t];n.intersectionRatio>0&&y(n.target)}})),m=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),t=0;t<e.length;t++){var n=e[t];void 0===n.responsivelyLazyObserver&&(n.responsivelyLazyObserver=!0,b.observe(n))}},L=null;var z=function(){i?(window.clearTimeout(L),L=window.setTimeout((function(){A=!0}),50)):A=!0},E=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),t=0;t<e.length;t++)for(var n=e[t].parentNode;n&&"html"!==n.tagName.toLowerCase();)void 0===n.responsivelyLazyScroll&&(n.responsivelyLazyScroll=!0,n.addEventListener("scroll",z)),n=n.parentNode},O=function(){(window.addEventListener("resize",(function(){f(),z()})),window.addEventListener("scroll",z),window.addEventListener("load",z),window.addEventListener("orientationchange",(function(){f(),z()})),i&&m(),E(),"undefined"!=typeof MutationObserver)&&new MutationObserver((function(){o||(i&&m(),E(),z())})).observe(document.querySelector("body"),{childList:!0,subtree:!0});p()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",O):O()}else p=function(){};return{run:p}}();
EOT;
