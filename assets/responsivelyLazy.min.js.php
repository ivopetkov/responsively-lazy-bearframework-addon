<?php

/*
 * Responsively lazy addon for Bear Framework
 * https://github.com/ivopetkov/responsively-lazy-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var responsivelyLazy=void 0!==responsivelyLazy?responsivelyLazy:function(){if(void 0!==window.addEventListener&&void 0!==document.querySelectorAll){var e=null,n="srcset"in document.createElement("img"),t=null,r=null,i="undefined"!=typeof IntersectionObserver,o=!1,l=function(e){var n=0,i=0,o=e.getAttribute("data-responsively-lazy-threshold");if(null!==o)if("px"===o.substr(-2))n=i=parseInt(o.substr(0,o.length-2),10);else if("%"===o.substr(-1)){var l=parseInt(o.substr(0,o.length-1),10)/100;n=Math.floor(t*l),i=Math.floor(r*l)}var a=e.getBoundingClientRect(),s=a.top,u=a.left,d=a.width,v=a.height,c=function(e,n,t){return e<t&&e+n>0?Math.min(t,e+n)-Math.max(0,e):0};return 0===(l=c(u,d,t)*c(s,v,r)/(d*v)*100)&&(i>0||n>0)&&(l=c(u-n,d+2*n,t)*c(s-i,v+2*i,r)/((d+2*n)*(v+2*i))),l},a=function(e,n){for(var t=e.length,r=n;r<t;r++){var i=!1,o=e[r],l=document.createElement("script"),s=o.getAttribute("type");null!==s&&l.setAttribute("type",s);var u=o.getAttribute("src");if(null!==u&&(l.setAttribute("src",u),(void 0===o.async||!1===o.async)&&r+1<t&&(i=!0,l.addEventListener("load",(function(){a(e,r+1)})))),l.innerHTML=o.innerHTML,o.parentNode.insertBefore(l,o),o.parentNode.removeChild(o),i)break}},s=[],u=!1,d=function(){if(!u){u=!0;s=s.filter((function(e){return 2!==e[2]}));for(var e=0;e<s.length;e++)s[e][4]=l(s[e][1]);s.sort((function(e,n){return n[4]-e[4]}));var n=s.filter((function(e){return 1===e[3]})).length;for(e=0;e<s.length&&!(n>=5);e++){var t=s[e];0===t[3]&&(t[3]=1,t[2](),n++)}u=!1}},v=0,c=function(n,t){var r=[],i=t.getAttribute("data-responsively-lazy"),o=null;if(null!==i&&(i=i.trim()).length>0){i=i.split(",");for(var l=0;l<i.length;l++){for(var a=null,u=999998,c=9,f=i[l].trim().split(" "),y=0;y<f.length;y++){var p=f[y],g=p.length;0!==g&&(null===a?a=p:"w"===p[g-1]?u=parseInt(p.substr(0,g-1),10):"webp"===p&&(c=2))}(e||2!==c)&&(r.push([a,u,c]),o<u&&(o=u))}r.sort((function(e,n){return e[1]===n[1]?e[2]-n[2]:e[1]-n[1]}));var w=[];for(l=0;l<r.length;l++){var h=r[l];l>0&&h[1]===w[w.length-1][1]||w.push([h[0],h[1]])}r=w}var m=t.offsetWidth*(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),A=null;for(l=0;l<r.length;l++){if((h=r[l])[1]>=m||h[1]===o){A=h;break}}if(null===A&&(A="img"===n?[t.getAttribute("src"),999999]:[null,999999]),void 0===t.responsivelyLazyOption&&(t.responsivelyLazyOption=["",0]),t.responsivelyLazyOption[1]<A[1]){t.responsivelyLazyOption=A;var b=A[0];if(null===b)return;!function(e,n,t){var r="i"+ ++v,i=null,o=function(){clearTimeout(i);for(var e=0;e<s.length;e++){var n=s[e];if(n[0]===r){n[3]=2;break}}d()},l=new Image;l.onload=function(){o(),t(!0)},l.onerror=function(){o(),t(!1)};s.push([r,e,function(){l.src=n,i=setTimeout(o,6e4)},0,0]),d()}(t,b,(function(e){if(e&&t.responsivelyLazyOption[0]===b){if("img"===n?b===t.getAttribute("src")?t.removeAttribute("srcset"):t.setAttribute("srcset",b):t.style.backgroundImage="url("+b+")",void 0===t.responsivelyLazyLoadDispached){t.responsivelyLazyLoadDispached=!0;var r=t.getAttribute("data-on-responsively-lazy-load");if(null!==r&&new Function(r).bind(t)(),"undefined"!=typeof Event){var i=new Event("responsively-lazy-load");t.dispatchEvent(i)}}}else t.responsivelyLazyOption=["",0]}))}},f=function(){t=window.innerWidth,r=window.innerHeight},y=function(e){if(void 0===e.responsivelyLazyDone&&0!==l(e)){var t=e.getAttribute("data-responsively-lazy-type");if("background"!==t&&"html"!==t&&(t="img"),"html"===t){e.responsivelyLazyDone=!0,o=!0,e.innerHTML=e.getAttribute("data-responsively-lazy");var r=e.querySelectorAll("script");r.length>0&&a(r,0),o=!1}else"img"===t?n&&c(t,e):c(t,e)}},p=function(n){if(null!==e)if(void 0!==n)y(t[r]);else for(var t=document.querySelectorAll("[data-responsively-lazy]"),r=0;r<t.length;r++){n=t[r];y(t[r])}},g=new Image;g.onload=g.onerror=function(){e=1===g.width,p()},g.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAD8D+JaQAA3AA/ua1AAA=",f();var w=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},h=!1,m=function(){h&&(h=!1,p()),w.call(null,m)};if(m(),i)var A=new IntersectionObserver((function(e){for(var n in e){var t=e[n];t.intersectionRatio>0&&y(t.target)}})),b=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),n=0;n<e.length;n++){var t=e[n];void 0===t.responsivelyLazyObserver&&(t.responsivelyLazyObserver=!0,A.observe(t))}},L=null;var z=function(){i?(window.clearTimeout(L),L=window.setTimeout((function(){h=!0}),50)):h=!0},E=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),n=0;n<e.length;n++)for(var t=e[n].parentNode;t&&"html"!==t.tagName.toLowerCase();)void 0===t.responsivelyLazyScroll&&(t.responsivelyLazyScroll=!0,t.addEventListener("scroll",z)),t=t.parentNode},O=function(){(window.addEventListener("resize",(function(){f(),z()})),window.addEventListener("scroll",z),window.addEventListener("load",z),window.addEventListener("orientationchange",(function(){f(),z()})),i&&b(),E(),"undefined"!=typeof MutationObserver)&&new MutationObserver((function(){o||(i&&b(),E(),z())})).observe(document.querySelector("body"),{childList:!0,subtree:!0});p()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",O):O()}else p=function(){};return{run:p}}();
EOT;
