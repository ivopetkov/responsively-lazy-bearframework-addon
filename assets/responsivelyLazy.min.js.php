<?php

/*
 * Responsively lazy addon for Bear Framework
 * https://github.com/ivopetkov/responsively-lazy-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var responsivelyLazy=void 0!==responsivelyLazy?responsivelyLazy:function(){if(void 0!==window.addEventListener&&void 0!==document.querySelectorAll){var e=null,n=null,t="srcset"in document.createElement("img"),A=null,r=null,i="undefined"!=typeof IntersectionObserver,o=!1,l=function(e){var n=0,t=0,i=e.getAttribute("data-responsively-lazy-threshold");if(null!==i)if("px"===i.substr(-2))n=t=parseInt(i.substr(0,i.length-2),10);else if("%"===i.substr(-1)){var o=parseInt(i.substr(0,i.length-1),10)/100;n=Math.floor(A*o),t=Math.floor(r*o)}var l=e.getBoundingClientRect(),a=l.top,s=l.left,u=l.width,d=l.height,v=function(e,n,t){return e<t&&e+n>0?Math.min(t,e+n)-Math.max(0,e):0};return 0===(o=v(s,u,A)*v(a,d,r)/(u*d)*100)&&(t>0||n>0)&&(o=v(s-n,u+2*n,A)*v(a-t,d+2*t,r)/((u+2*n)*(d+2*t))),o},a=function(e,n){for(var t=e.length,A=n;A<t;A++){var r=!1,i=e[A],o=document.createElement("script"),l=i.getAttribute("type");null!==l&&o.setAttribute("type",l);var s=i.getAttribute("src");if(null!==s&&(o.setAttribute("src",s),(void 0===i.async||!1===i.async)&&A+1<t&&(r=!0,o.addEventListener("load",(function(){a(e,A+1)})))),o.innerHTML=i.innerHTML,i.parentNode.insertBefore(o,i),i.parentNode.removeChild(i),r)break}},s=[],u=!1,d=function(){if(!u){u=!0;s=s.filter((function(e){return 2!==e[2]}));for(var e=0;e<s.length;e++)s[e][4]=l(s[e][1]);s.sort((function(e,n){return n[4]-e[4]}));var n=s.filter((function(e){return 1===e[3]})).length;for(e=0;e<s.length&&!(n>=5);e++){var t=s[e];0===t[3]&&(t[3]=1,t[2](),n++)}u=!1}},v=0,c=function(t,A){var r=[],i=A.getAttribute("data-responsively-lazy"),o=null;if(null!==i&&(i=i.trim()).length>0){i=i.split(",");for(var l=0;l<i.length;l++){for(var a=null,u=999998,c=9,f=i[l].trim().split(" "),y=0;y<f.length;y++){var p=f[y],g=p.length;0!==g&&(null===a?a=p:"w"===p[g-1]?u=parseInt(p.substr(0,g-1),10):"webp"===p?c=3:"avif"===p&&(c=2))}(e||3!==c)&&((n||2!==c)&&(r.push([a,u,c]),o<u&&(o=u)))}r.sort((function(e,n){return e[1]===n[1]?e[2]-n[2]:e[1]-n[1]}));var h=[];for(l=0;l<r.length;l++){var b=r[l];l>0&&b[1]===h[h.length-1][1]||h.push([b[0],b[1]])}r=h}var m=A.getAttribute("data-responsively-lazy-preferred-option"),w=null!==m?parseInt(m):A.offsetWidth*(void 0!==window.devicePixelRatio?window.devicePixelRatio:1),L=null;for(l=0;l<r.length;l++){if((b=r[l])[1]>=w||b[1]===o){L=b;break}}if(null===L&&(L="img"===t?[A.getAttribute("src"),999999]:[null,999999]),void 0===A.responsivelyLazyOption&&(A.responsivelyLazyOption=["",0]),A.responsivelyLazyOption[1]<L[1]){A.responsivelyLazyOption=L;var z=L[0];if(null===z)return;!function(e,n,t){var A="i"+ ++v,r=null,i=function(){clearTimeout(r);for(var e=0;e<s.length;e++){var n=s[e];if(n[0]===A){n[3]=2;break}}d()},o=new Image;o.onload=function(){i(),t(!0)},o.onerror=function(){i(),t(!1)};s.push([A,e,function(){o.src=n,r=setTimeout(i,6e4)},0,0]),d()}(A,z,(function(e){if(e&&A.responsivelyLazyOption[0]===z){if("img"===t?z===A.getAttribute("src")?A.removeAttribute("srcset"):A.setAttribute("srcset",z):A.style.backgroundImage="url("+z+")",void 0===A.responsivelyLazyLoadDispached){A.responsivelyLazyLoadDispached=!0;var n=A.getAttribute("data-on-responsively-lazy-load");if(null!==n&&new Function(n).bind(A)(),"undefined"!=typeof Event){var r=new Event("responsively-lazy-load");A.dispatchEvent(r)}}}else A.responsivelyLazyOption=["",0]}))}},f=function(){A=window.innerWidth,r=window.innerHeight},y=function(e){if(void 0===e.responsivelyLazyDone&&0!==l(e)){var n=e.getAttribute("data-responsively-lazy-type");if("background"!==n&&"html"!==n&&(n="img"),"html"===n){e.responsivelyLazyDone=!0,o=!0,e.innerHTML=e.getAttribute("data-responsively-lazy");var A=e.querySelectorAll("script");A.length>0&&a(A,0),o=!1}else"img"===n?t&&c(n,e):c(n,e)}},p=function(t){if(null!==e&&null!==n)if(void 0!==t)y(A[r]);else for(var A=document.querySelectorAll("[data-responsively-lazy]"),r=0;r<A.length;r++){t=A[r];y(A[r])}},g=function(e,n){var t=new Image;t.onload=t.onerror=function(){n(t)},t.src="data:image/webp;base64,"+e},h=function(){null!==e&&null!==n&&p()};g("UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAD8D+JaQAA3AA/ua1AAA=",(function(n){e=1===n.width,h()})),g("AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAACAAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgSAAAAAAABNjb2xybmNseAABAA0AAIAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAChtZGF0EgAKBzgABpAQ0AIyExAAAAAP+j9adAx6kYPdyoRe9BA=",(function(e){n=1===e.width,h()})),f();var b=window.requestAnimationFrame||function(e){window.setTimeout(e,20)},m=!1,w=function(){m&&(m=!1,p()),b.call(null,w)};if(w(),i)var L=new IntersectionObserver((function(e){for(var n in e){var t=e[n];t.intersectionRatio>0&&y(t.target)}})),z=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),n=0;n<e.length;n++){var t=e[n];void 0===t.responsivelyLazyObserver&&(t.responsivelyLazyObserver=!0,L.observe(t))}},B=null;var E=function(){i?(window.clearTimeout(B),B=window.setTimeout((function(){m=!0}),50)):m=!0},I=function(){for(var e=document.querySelectorAll("[data-responsively-lazy]"),n=0;n<e.length;n++)for(var t=e[n].parentNode;t&&"html"!==t.tagName.toLowerCase();)void 0===t.responsivelyLazyScroll&&(t.responsivelyLazyScroll=!0,t.addEventListener("scroll",E)),t=t.parentNode},x=!1,O=function(){x||(x=!0,window.addEventListener("resize",(function(){f(),E()})),window.addEventListener("scroll",E),window.addEventListener("load",E),window.addEventListener("orientationchange",(function(){f(),E()})),i&&z(),I(),"undefined"!=typeof MutationObserver&&new MutationObserver((function(){o||(i&&z(),I(),E())})).observe(document.querySelector("body"),{childList:!0,subtree:!0}))};document.addEventListener("readystatechange",()=>{O(),p()}),"complete"===document.readyState&&(O(),p())}else p=function(){};return{run:p}}();
EOT;
